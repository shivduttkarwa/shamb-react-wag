{% extends "payments/admin/base.html" %}
{% load i18n %}

{% block content_content %}
    <div class="listing">
        {% if submissions %}
            <table class="listing">
                <thead>
                    <tr>
                        <th>{% trans "Name" %}</th>
                        <th>{% trans "Email" %}</th>
                        <th>{% trans "Transaction ID" %}</th>
                        <th>{% trans "Status" %}</th>
                        <th>{% trans "Amount" %}</th>
                        <th>{% trans "Submitted" %}</th>
                        <th>{% trans "Actions" %}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for submission in submissions %}
                        <tr>
                            <td>{{ submission.full_name }}</td>
                            <td>
                                <a href="mailto:{{ submission.email }}">{{ submission.email }}</a>
                            </td>
                            <td><code>{{ submission.transaction_id }}</code></td>
                            <td>
                                <span class="status-tag status-{{ submission.payment_status }}">
                                    {{ submission.get_payment_status_display }}
                                </span>
                            </td>
                            <td>{{ submission.amount|default:"0.00" }} {{ submission.currency }}</td>
                            <td>{{ submission.submitted_at|date:"Y-m-d H:i" }}</td>
                            <td>
                                <a href="#" class="button button-small" onclick="toggleDetails('{{ submission.id }}')">
                                    {% trans "View Details" %}
                                </a>
                            </td>
                        </tr>
                        <tr id="details-{{ submission.id }}" style="display: none;">
                            <td colspan="7">
                                <div class="nice-padding">
                                    <div class="row">
                                        <div class="col6">
                                            <h4>{% trans "Personal Information" %}</h4>
                                            <p><strong>{% trans "Name:" %}</strong> {{ submission.full_name }}</p>
                                            <p><strong>{% trans "Email:" %}</strong> {{ submission.email }}</p>
                                            <p><strong>{% trans "Phone:" %}</strong> {{ submission.phone }}</p>
                                            
                                            <h4>{% trans "Billing Address" %}</h4>
                                            <p>{{ submission.address }}</p>
                                            <p>{{ submission.city }}, {{ submission.postal_code }}</p>
                                            <p>{{ submission.country }}</p>
                                        </div>
                                        <div class="col6">
                                            <h4>{% trans "Payment Information" %}</h4>
                                            <p><strong>{% trans "Card:" %}</strong> {{ submission.get_masked_card_number }}</p>
                                            <p><strong>{% trans "Name on Card:" %}</strong> {{ submission.card_name }}</p>
                                            <p><strong>{% trans "Expiry:" %}</strong> {{ submission.expiry_date }}</p>
                                            
                                            <h4>{% trans "Transaction Details" %}</h4>
                                            <p><strong>{% trans "Transaction ID:" %}</strong> <code>{{ submission.transaction_id }}</code></p>
                                            <p><strong>{% trans "Status:" %}</strong> {{ submission.get_payment_status_display }}</p>
                                            <p><strong>{% trans "Amount:" %}</strong> {{ submission.amount|default:"0.00" }} {{ submission.currency }}</p>
                                        </div>
                                    </div>
                                    
                                    <h4>{% trans "Technical Details" %}</h4>
                                    <p><strong>{% trans "IP Address:" %}</strong> {{ submission.ip_address|default:"N/A" }}</p>
                                    <p><strong>{% trans "User Agent:" %}</strong> {{ submission.user_agent|default:"N/A" }}</p>
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <div class="help-block">
                <p>{% trans "No payment form submissions yet." %}</p>
            </div>
        {% endif %}
    </div>

    <style>
        .status-tag {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }
        .status-pending { background-color: #ffc107; color: #856404; }
        .status-completed { background-color: #28a745; color: white; }
        .status-failed { background-color: #dc3545; color: white; }
        .status-refunded { background-color: #6c757d; color: white; }
        .row { display: flex; margin: 0 -15px; }
        .col6 { flex: 1; padding: 0 15px; }
    </style>

    <script>
        function toggleDetails(id) {
            var element = document.getElementById('details-' + id);
            element.style.display = element.style.display === 'none' ? 'table-row' : 'none';
        }
    </script>
{% endblock %}
